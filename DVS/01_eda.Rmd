---
title: "DVS Analysis"
author: "Amit Levinson"
date: "2/6/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

Below we'll be analyzing the DVS survey results.


```{r}
library(googlesheets4)
library(readr)
library(janitor)
library(tidyr)
library(dplyr)
library(ggplot2)
library(forcats)
library(stringr)
library(tidygraph)
```

```{r}
# dat_raw <- read_sheet("https://docs.google.com/spreadsheets/d/1lDkxioTmT5--JufJuYryiV5fKsdQQopvlSJO4Gh0ors/edit#gid=532705671", sheet = "data_2021_main", skip = 3)
# write_csv(dat_raw, "survey_results.csv")
```

```{r}
dat_raw <- read_csv("survey_results.csv") %>% 
  clean_names()  

theme_set(theme_minimal() +
            theme(
              text = element_text(family = "Raleway"),
              plot.title = element_text(family = "Merriweather", size = 16, face = "bold"),
              panel.grid.minor.x = element_blank()
            )
          )
```

Questions we're interested in:

1. What are the various roles respondents have? [q01]

1. How long did someone work on DV in the past week? [q03]

1. Time devoted to aspects of data visualization [q04]

1. Years of experience [q06]

1. Years of professional experience [q07]

1. Salary [q09]

1. Tools people use

1. Tools people use together


### Various roles

```{r}
dat_1to60 <- dat_raw %>% 
  select(1:60)
  
```

What are the roles respondents have?

```{r}
dat_1to60 %>% 
  pivot_longer(cols = starts_with("dv_roles_"), names_prefix = "dv_roles_", names_to = "role", values_to = "response", values_drop_na = TRUE) %>% 
  count(response) %>% 
  mutate(response = str_wrap(response, 40),
        response= fct_reorder(response, n)) %>% 
  ggplot(aes(y= response, x = n))+
  geom_col() +
   theme(
     panel.grid.major.y = element_blank()
   )
```

How long did someone work on DV in the past week? [q03]

```{r}
```


Years of experience [q06]

```{r}
dat_1to60 %>% 
  count(years_dv_experience) %>% 
  # mutate(years_dv_experience = as.character(years_dv_experience),
  #        years_dv_experience = factor(years_dv_experience, levels = c("Less than 1 year", "1" , "2", "3", "4", "5", "6-10", "11-15","16-20", "21-25", "26-30", "More than 30"), labels = c("Less than 1 year", "1" , "2", "3", "4", "5", "6-10", "11-15","16-20", "21-25", "26-30", "More than 30"))) %>%
  ggplot(aes(y= years_dv_experience, x = n))+
  geom_col() +
   theme(
     panel.grid.major.y = element_blank()
   )
```

What is respondents' salary? 

```{r}
dat_1to60 %>% 
  count(pay_annual, sort = T) %>% 
  mutate(
    pay_annual = factor(pay_annual)
  ) %>% 
  ggplot(aes(y= pay_annual, x = n))+
  geom_col() +
   theme(
     panel.grid.major.y = element_blank()
   )
```

### Tools people use

```{r}
tools_used <- dat_raw %>% 
  pivot_longer(cols = contains("tools_for_dv_"), names_prefix = "tools_for_dv_", values_to = "tool",values_drop_na = TRUE) %>% 
  pivot_longer(cols = starts_with("dv_roles_"), names_prefix = "dv_roles_", names_to = "role", values_to = "response", values_drop_na = TRUE) %>% 
  select(chron_id ,  response, tool)
```

Tools used distinctly by respondent:

```{r}
tools_used %>% 
  distinct(chron_id, tool) %>% 
  count(tool, sort = T)
```

Tools used per work category?

```{r}
tools_used %>% 
  count(response, tool, sort = T) %>% 
  filter(n > 49) %>% 
  ggplot(aes(x = tool, y = response, fill = n)) +
  geom_tile() +
  theme(
    axis.text.x = element_text(angle = 90)
  )
```

### Tools people use together

```{r}
tools_used_respodnent <- tools_used %>% 
  distinct(chron_id, tool)
  
tools_used_respodnent %>% 
  full_join(tools_used_respodnent, by = "chron_id") %>% 
  filter(tool.x < tool.y) %>% 
  count(tool.x, tool.y, sort = T) 
  


```




